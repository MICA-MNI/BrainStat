
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "python/generated_tutorials/plot_tutorial_01_basics.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_python_generated_tutorials_plot_tutorial_01_basics.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_python_generated_tutorials_plot_tutorial_01_basics.py:


Tutorial 01: Linear Models
=========================================
In this tutorial you will set up your first linear model with BrainStat. 
To this end, we will load some sample data from the ABIDE dataset. Note that,
contrary to the results shown in our manuscript, we are only using a few sites
to reduce computation time in this tutorial. As such the results shown here
differ from those reported in our manuscript. To get identical results,
simply set `sites` to `None`. 

.. GENERATED FROM PYTHON SOURCE LINES 11-25

.. code-block:: default



    import numpy as np

    from brainstat.datasets import fetch_mask, fetch_template_surface
    from brainstat.tutorial.utils import fetch_abide_data

    # Load behavioral markers
    sites = ("PITT", "OLIN", "OHSU")
    thickness, demographics = fetch_abide_data(sites=sites)
    pial_left, pial_right = fetch_template_surface("civet41k", join=False)
    pial_combined = fetch_template_surface("civet41k", join=True)
    mask = fetch_mask("civet41k")





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    0it [00:00, ?it/s]    Fetching thickness data for subject 1 out of 116: : 0it [00:00, ?it/s]    Fetching thickness data for subject 1 out of 116: : 1it [00:00,  3.84it/s]    Fetching thickness data for subject 2 out of 116: : 1it [00:00,  3.84it/s]    Fetching thickness data for subject 2 out of 116: : 2it [00:00,  4.14it/s]    Fetching thickness data for subject 3 out of 116: : 2it [00:00,  4.14it/s]    Fetching thickness data for subject 3 out of 116: : 3it [00:00,  4.25it/s]    Fetching thickness data for subject 4 out of 116: : 3it [00:00,  4.25it/s]    Fetching thickness data for subject 4 out of 116: : 4it [00:00,  4.27it/s]    Fetching thickness data for subject 5 out of 116: : 4it [00:00,  4.27it/s]    Fetching thickness data for subject 5 out of 116: : 5it [00:01,  4.33it/s]    Fetching thickness data for subject 6 out of 116: : 5it [00:01,  4.33it/s]    Fetching thickness data for subject 6 out of 116: : 6it [00:01,  4.36it/s]    Fetching thickness data for subject 7 out of 116: : 6it [00:01,  4.36it/s]    Fetching thickness data for subject 7 out of 116: : 7it [00:01,  4.38it/s]    Fetching thickness data for subject 8 out of 116: : 7it [00:01,  4.38it/s]    Fetching thickness data for subject 8 out of 116: : 8it [00:01,  4.37it/s]    Fetching thickness data for subject 9 out of 116: : 8it [00:01,  4.37it/s]    Fetching thickness data for subject 9 out of 116: : 9it [00:02,  4.33it/s]    Fetching thickness data for subject 10 out of 116: : 9it [00:02,  4.33it/s]    Fetching thickness data for subject 10 out of 116: : 10it [00:02,  4.30it/s]    Fetching thickness data for subject 11 out of 116: : 10it [00:02,  4.30it/s]    Fetching thickness data for subject 11 out of 116: : 11it [00:02,  4.28it/s]    Fetching thickness data for subject 12 out of 116: : 11it [00:02,  4.28it/s]    Fetching thickness data for subject 12 out of 116: : 12it [00:02,  4.28it/s]    Fetching thickness data for subject 13 out of 116: : 12it [00:02,  4.28it/s]    Fetching thickness data for subject 13 out of 116: : 13it [00:03,  4.16it/s]    Fetching thickness data for subject 14 out of 116: : 13it [00:03,  4.16it/s]    Fetching thickness data for subject 14 out of 116: : 14it [00:03,  4.21it/s]    Fetching thickness data for subject 15 out of 116: : 14it [00:03,  4.21it/s]    Fetching thickness data for subject 15 out of 116: : 15it [00:03,  4.22it/s]    Fetching thickness data for subject 16 out of 116: : 15it [00:03,  4.22it/s]    Fetching thickness data for subject 16 out of 116: : 16it [00:03,  4.27it/s]    Fetching thickness data for subject 17 out of 116: : 16it [00:03,  4.27it/s]    Fetching thickness data for subject 17 out of 116: : 17it [00:03,  4.33it/s]    Fetching thickness data for subject 18 out of 116: : 17it [00:03,  4.33it/s]    Fetching thickness data for subject 18 out of 116: : 18it [00:04,  4.30it/s]    Fetching thickness data for subject 19 out of 116: : 18it [00:04,  4.30it/s]    Fetching thickness data for subject 19 out of 116: : 19it [00:04,  2.75it/s]    Fetching thickness data for subject 20 out of 116: : 19it [00:04,  2.75it/s]    Fetching thickness data for subject 20 out of 116: : 20it [00:05,  2.40it/s]    Fetching thickness data for subject 21 out of 116: : 20it [00:05,  2.40it/s]    Fetching thickness data for subject 21 out of 116: : 21it [00:06,  2.01it/s]    Fetching thickness data for subject 22 out of 116: : 21it [00:06,  2.01it/s]    Fetching thickness data for subject 22 out of 116: : 22it [00:06,  2.20it/s]    Fetching thickness data for subject 23 out of 116: : 22it [00:06,  2.20it/s]    Fetching thickness data for subject 23 out of 116: : 23it [00:06,  2.48it/s]    Fetching thickness data for subject 24 out of 116: : 23it [00:06,  2.48it/s]    Fetching thickness data for subject 24 out of 116: : 24it [00:07,  2.77it/s]    Fetching thickness data for subject 25 out of 116: : 24it [00:07,  2.77it/s]    Fetching thickness data for subject 25 out of 116: : 25it [00:07,  3.11it/s]    Fetching thickness data for subject 26 out of 116: : 25it [00:07,  3.11it/s]    Fetching thickness data for subject 26 out of 116: : 26it [00:07,  3.37it/s]    Fetching thickness data for subject 27 out of 116: : 26it [00:07,  3.37it/s]    Fetching thickness data for subject 27 out of 116: : 27it [00:07,  3.55it/s]    Fetching thickness data for subject 28 out of 116: : 27it [00:07,  3.55it/s]    Fetching thickness data for subject 28 out of 116: : 28it [00:07,  3.62it/s]    Fetching thickness data for subject 29 out of 116: : 28it [00:07,  3.62it/s]    Fetching thickness data for subject 29 out of 116: : 29it [00:08,  3.80it/s]    Fetching thickness data for subject 30 out of 116: : 29it [00:08,  3.80it/s]    Fetching thickness data for subject 30 out of 116: : 30it [00:08,  3.93it/s]    Fetching thickness data for subject 31 out of 116: : 30it [00:08,  3.93it/s]    Fetching thickness data for subject 31 out of 116: : 31it [00:08,  3.95it/s]    Fetching thickness data for subject 32 out of 116: : 31it [00:08,  3.95it/s]    Fetching thickness data for subject 32 out of 116: : 32it [00:08,  4.05it/s]    Fetching thickness data for subject 33 out of 116: : 32it [00:08,  4.05it/s]    Fetching thickness data for subject 33 out of 116: : 33it [00:09,  3.86it/s]    Fetching thickness data for subject 34 out of 116: : 33it [00:09,  3.86it/s]    Fetching thickness data for subject 34 out of 116: : 34it [00:09,  3.37it/s]    Fetching thickness data for subject 35 out of 116: : 34it [00:09,  3.37it/s]    Fetching thickness data for subject 35 out of 116: : 35it [00:09,  3.36it/s]    Fetching thickness data for subject 36 out of 116: : 35it [00:09,  3.36it/s]    Fetching thickness data for subject 36 out of 116: : 36it [00:10,  3.61it/s]    Fetching thickness data for subject 37 out of 116: : 36it [00:10,  3.61it/s]    Fetching thickness data for subject 37 out of 116: : 37it [00:10,  3.81it/s]    Fetching thickness data for subject 38 out of 116: : 37it [00:10,  3.81it/s]    Fetching thickness data for subject 38 out of 116: : 38it [00:10,  3.88it/s]    Fetching thickness data for subject 39 out of 116: : 38it [00:10,  3.88it/s]    Fetching thickness data for subject 39 out of 116: : 39it [00:10,  3.96it/s]    Fetching thickness data for subject 40 out of 116: : 39it [00:10,  3.96it/s]    Fetching thickness data for subject 40 out of 116: : 40it [00:11,  3.87it/s]    Fetching thickness data for subject 41 out of 116: : 40it [00:11,  3.87it/s]    Fetching thickness data for subject 41 out of 116: : 41it [00:11,  3.84it/s]    Fetching thickness data for subject 42 out of 116: : 41it [00:11,  3.84it/s]    Fetching thickness data for subject 42 out of 116: : 42it [00:11,  3.75it/s]    Fetching thickness data for subject 43 out of 116: : 42it [00:11,  3.75it/s]    Fetching thickness data for subject 43 out of 116: : 43it [00:11,  3.84it/s]    Fetching thickness data for subject 44 out of 116: : 43it [00:11,  3.84it/s]    Fetching thickness data for subject 44 out of 116: : 44it [00:12,  3.83it/s]    Fetching thickness data for subject 45 out of 116: : 44it [00:12,  3.83it/s]    Fetching thickness data for subject 45 out of 116: : 45it [00:12,  3.90it/s]    Fetching thickness data for subject 46 out of 116: : 45it [00:12,  3.90it/s]    Fetching thickness data for subject 46 out of 116: : 46it [00:12,  3.94it/s]    Fetching thickness data for subject 47 out of 116: : 46it [00:12,  3.94it/s]    Fetching thickness data for subject 47 out of 116: : 47it [00:12,  4.00it/s]    Fetching thickness data for subject 48 out of 116: : 47it [00:12,  4.00it/s]    Fetching thickness data for subject 48 out of 116: : 48it [00:13,  3.93it/s]    Fetching thickness data for subject 49 out of 116: : 48it [00:13,  3.93it/s]    Fetching thickness data for subject 49 out of 116: : 49it [00:13,  3.95it/s]    Fetching thickness data for subject 50 out of 116: : 49it [00:13,  3.95it/s]    Fetching thickness data for subject 50 out of 116: : 50it [00:13,  4.03it/s]    Fetching thickness data for subject 51 out of 116: : 50it [00:13,  4.03it/s]    Fetching thickness data for subject 51 out of 116: : 51it [00:13,  4.12it/s]    Fetching thickness data for subject 52 out of 116: : 51it [00:13,  4.12it/s]    Fetching thickness data for subject 52 out of 116: : 52it [00:14,  4.18it/s]    Fetching thickness data for subject 53 out of 116: : 52it [00:14,  4.18it/s]    Fetching thickness data for subject 53 out of 116: : 53it [00:14,  4.21it/s]    Fetching thickness data for subject 54 out of 116: : 53it [00:14,  4.21it/s]    Fetching thickness data for subject 54 out of 116: : 54it [00:14,  4.15it/s]    Fetching thickness data for subject 55 out of 116: : 54it [00:14,  4.15it/s]    Fetching thickness data for subject 55 out of 116: : 55it [00:14,  4.04it/s]    Fetching thickness data for subject 56 out of 116: : 55it [00:14,  4.04it/s]    Fetching thickness data for subject 56 out of 116: : 56it [00:15,  3.80it/s]    Fetching thickness data for subject 57 out of 116: : 56it [00:15,  3.80it/s]    Fetching thickness data for subject 57 out of 116: : 57it [00:15,  3.91it/s]    Fetching thickness data for subject 58 out of 116: : 57it [00:15,  3.91it/s]    Fetching thickness data for subject 58 out of 116: : 58it [00:15,  3.88it/s]    Fetching thickness data for subject 59 out of 116: : 58it [00:15,  3.88it/s]    Fetching thickness data for subject 59 out of 116: : 59it [00:15,  3.99it/s]    Fetching thickness data for subject 60 out of 116: : 59it [00:15,  3.99it/s]    Fetching thickness data for subject 60 out of 116: : 60it [00:16,  3.87it/s]    Fetching thickness data for subject 61 out of 116: : 60it [00:16,  3.87it/s]    Fetching thickness data for subject 61 out of 116: : 61it [00:16,  3.58it/s]    Fetching thickness data for subject 62 out of 116: : 61it [00:16,  3.58it/s]    Fetching thickness data for subject 62 out of 116: : 62it [00:16,  3.71it/s]    Fetching thickness data for subject 63 out of 116: : 62it [00:16,  3.71it/s]    Fetching thickness data for subject 63 out of 116: : 63it [00:17,  3.79it/s]    Fetching thickness data for subject 64 out of 116: : 63it [00:17,  3.79it/s]    Fetching thickness data for subject 64 out of 116: : 64it [00:17,  3.70it/s]    Fetching thickness data for subject 65 out of 116: : 64it [00:17,  3.70it/s]    Fetching thickness data for subject 65 out of 116: : 65it [00:17,  3.75it/s]    Fetching thickness data for subject 66 out of 116: : 65it [00:17,  3.75it/s]    Fetching thickness data for subject 66 out of 116: : 66it [00:17,  3.83it/s]    Fetching thickness data for subject 67 out of 116: : 66it [00:17,  3.83it/s]    Fetching thickness data for subject 67 out of 116: : 67it [00:18,  3.80it/s]    Fetching thickness data for subject 68 out of 116: : 67it [00:18,  3.80it/s]    Fetching thickness data for subject 68 out of 116: : 68it [00:18,  3.72it/s]    Fetching thickness data for subject 69 out of 116: : 68it [00:18,  3.72it/s]    Fetching thickness data for subject 69 out of 116: : 69it [00:18,  3.83it/s]    Fetching thickness data for subject 70 out of 116: : 69it [00:18,  3.83it/s]    Fetching thickness data for subject 70 out of 116: : 70it [00:18,  3.97it/s]    Fetching thickness data for subject 71 out of 116: : 70it [00:18,  3.97it/s]    Fetching thickness data for subject 71 out of 116: : 71it [00:19,  4.10it/s]    Fetching thickness data for subject 72 out of 116: : 71it [00:19,  4.10it/s]    Fetching thickness data for subject 72 out of 116: : 72it [00:19,  4.02it/s]    Fetching thickness data for subject 73 out of 116: : 72it [00:19,  4.02it/s]    Fetching thickness data for subject 73 out of 116: : 73it [00:19,  4.03it/s]    Fetching thickness data for subject 74 out of 116: : 73it [00:19,  4.03it/s]    Fetching thickness data for subject 74 out of 116: : 74it [00:19,  4.05it/s]    Fetching thickness data for subject 75 out of 116: : 74it [00:19,  4.05it/s]    Fetching thickness data for subject 75 out of 116: : 75it [00:20,  3.75it/s]    Fetching thickness data for subject 76 out of 116: : 75it [00:20,  3.75it/s]    Fetching thickness data for subject 76 out of 116: : 76it [00:20,  3.74it/s]    Fetching thickness data for subject 77 out of 116: : 76it [00:20,  3.74it/s]    Fetching thickness data for subject 77 out of 116: : 77it [00:20,  3.85it/s]    Fetching thickness data for subject 78 out of 116: : 77it [00:20,  3.85it/s]    Fetching thickness data for subject 78 out of 116: : 78it [00:20,  3.99it/s]    Fetching thickness data for subject 79 out of 116: : 78it [00:20,  3.99it/s]    Fetching thickness data for subject 79 out of 116: : 79it [00:21,  4.08it/s]    Fetching thickness data for subject 80 out of 116: : 79it [00:21,  4.08it/s]    Fetching thickness data for subject 80 out of 116: : 80it [00:21,  4.02it/s]    Fetching thickness data for subject 81 out of 116: : 80it [00:21,  4.02it/s]    Fetching thickness data for subject 81 out of 116: : 81it [00:21,  3.76it/s]    Fetching thickness data for subject 82 out of 116: : 81it [00:21,  3.76it/s]    Fetching thickness data for subject 82 out of 116: : 82it [00:21,  3.47it/s]    Fetching thickness data for subject 83 out of 116: : 82it [00:21,  3.47it/s]    Fetching thickness data for subject 83 out of 116: : 83it [00:22,  3.59it/s]    Fetching thickness data for subject 84 out of 116: : 83it [00:22,  3.59it/s]    Fetching thickness data for subject 84 out of 116: : 84it [00:22,  3.61it/s]    Fetching thickness data for subject 85 out of 116: : 84it [00:22,  3.61it/s]    Fetching thickness data for subject 85 out of 116: : 85it [00:22,  3.77it/s]    Fetching thickness data for subject 86 out of 116: : 85it [00:22,  3.77it/s]    Fetching thickness data for subject 86 out of 116: : 86it [00:22,  3.91it/s]    Fetching thickness data for subject 87 out of 116: : 86it [00:22,  3.91it/s]    Fetching thickness data for subject 87 out of 116: : 87it [00:23,  4.03it/s]    Fetching thickness data for subject 88 out of 116: : 87it [00:23,  4.03it/s]    Fetching thickness data for subject 88 out of 116: : 88it [00:23,  3.69it/s]    Fetching thickness data for subject 89 out of 116: : 88it [00:23,  3.69it/s]    Fetching thickness data for subject 89 out of 116: : 89it [00:23,  3.77it/s]    Fetching thickness data for subject 90 out of 116: : 89it [00:23,  3.77it/s]    Fetching thickness data for subject 90 out of 116: : 90it [00:24,  3.86it/s]    Fetching thickness data for subject 91 out of 116: : 90it [00:24,  3.86it/s]    Fetching thickness data for subject 91 out of 116: : 91it [00:24,  3.99it/s]    Fetching thickness data for subject 92 out of 116: : 91it [00:24,  3.99it/s]    Fetching thickness data for subject 92 out of 116: : 92it [00:24,  4.06it/s]    Fetching thickness data for subject 93 out of 116: : 92it [00:24,  4.06it/s]    Fetching thickness data for subject 93 out of 116: : 93it [00:24,  4.09it/s]    Fetching thickness data for subject 94 out of 116: : 93it [00:24,  4.09it/s]    Fetching thickness data for subject 94 out of 116: : 94it [00:24,  4.14it/s]    Fetching thickness data for subject 95 out of 116: : 94it [00:24,  4.14it/s]    Fetching thickness data for subject 95 out of 116: : 95it [00:25,  3.58it/s]    Fetching thickness data for subject 96 out of 116: : 95it [00:25,  3.58it/s]    Fetching thickness data for subject 96 out of 116: : 96it [00:25,  3.49it/s]    Fetching thickness data for subject 97 out of 116: : 96it [00:25,  3.49it/s]    Fetching thickness data for subject 97 out of 116: : 97it [00:26,  3.08it/s]    Fetching thickness data for subject 98 out of 116: : 97it [00:26,  3.08it/s]    Fetching thickness data for subject 98 out of 116: : 98it [00:26,  3.30it/s]    Fetching thickness data for subject 99 out of 116: : 98it [00:26,  3.30it/s]    Fetching thickness data for subject 99 out of 116: : 99it [00:26,  3.37it/s]    Fetching thickness data for subject 100 out of 116: : 99it [00:26,  3.37it/s]    Fetching thickness data for subject 100 out of 116: : 100it [00:26,  3.58it/s]    Fetching thickness data for subject 101 out of 116: : 100it [00:26,  3.58it/s]    Fetching thickness data for subject 101 out of 116: : 101it [00:27,  3.79it/s]    Fetching thickness data for subject 102 out of 116: : 101it [00:27,  3.79it/s]    Fetching thickness data for subject 102 out of 116: : 102it [00:27,  3.60it/s]    Fetching thickness data for subject 103 out of 116: : 102it [00:27,  3.60it/s]    Fetching thickness data for subject 103 out of 116: : 103it [00:27,  3.02it/s]    Fetching thickness data for subject 104 out of 116: : 103it [00:27,  3.02it/s]    Fetching thickness data for subject 104 out of 116: : 104it [00:28,  2.90it/s]    Fetching thickness data for subject 105 out of 116: : 104it [00:28,  2.90it/s]    Fetching thickness data for subject 105 out of 116: : 105it [00:28,  3.00it/s]    Fetching thickness data for subject 106 out of 116: : 105it [00:28,  3.00it/s]    Fetching thickness data for subject 106 out of 116: : 106it [00:28,  2.96it/s]    Fetching thickness data for subject 107 out of 116: : 106it [00:28,  2.96it/s]    Fetching thickness data for subject 107 out of 116: : 107it [00:29,  2.41it/s]    Fetching thickness data for subject 108 out of 116: : 107it [00:29,  2.41it/s]    Fetching thickness data for subject 108 out of 116: : 108it [00:29,  2.36it/s]    Fetching thickness data for subject 109 out of 116: : 108it [00:29,  2.36it/s]    Fetching thickness data for subject 109 out of 116: : 109it [00:30,  2.39it/s]    Fetching thickness data for subject 110 out of 116: : 109it [00:30,  2.39it/s]    Fetching thickness data for subject 110 out of 116: : 110it [00:30,  2.36it/s]    Fetching thickness data for subject 111 out of 116: : 110it [00:30,  2.36it/s]    Fetching thickness data for subject 111 out of 116: : 111it [00:31,  2.49it/s]    Fetching thickness data for subject 112 out of 116: : 111it [00:31,  2.49it/s]    Fetching thickness data for subject 112 out of 116: : 112it [00:31,  2.78it/s]    Fetching thickness data for subject 113 out of 116: : 112it [00:31,  2.78it/s]    Fetching thickness data for subject 113 out of 116: : 113it [00:31,  3.06it/s]    Fetching thickness data for subject 114 out of 116: : 113it [00:31,  3.06it/s]    Fetching thickness data for subject 114 out of 116: : 114it [00:31,  3.32it/s]    Fetching thickness data for subject 115 out of 116: : 114it [00:31,  3.32it/s]    Fetching thickness data for subject 115 out of 116: : 115it [00:32,  3.40it/s]    Fetching thickness data for subject 116 out of 116: : 115it [00:32,  3.40it/s]    Fetching thickness data for subject 116 out of 116: : 116it [00:32,  3.32it/s]    Fetching thickness data for subject 116 out of 116: : 116it [00:32,  3.58it/s]




.. GENERATED FROM PYTHON SOURCE LINES 26-29

Lets have a look at the cortical thickness data. To do this,
we will use the surface plotter included with BrainSpace. Lets plot
mean thickness.

.. GENERATED FROM PYTHON SOURCE LINES 29-45

.. code-block:: default

    from brainspace.plotting import plot_hemispheres

    plot_hemispheres(
        pial_left,
        pial_right,
        np.mean(thickness, axis=0),
        color_bar=True,
        color_range=(1.5, 3.5),
        label_text=["Cortical Thickness"],
        embed_nb=True,
        size=(1400, 200),
        zoom=1.45,
        cb__labelTextProperty={"fontSize": 12},
    )





.. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_001.png
    :alt: plot tutorial 01 basics
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /Users/reinder/opt/miniconda3/envs/python3.8/lib/python3.8/site-packages/brainspace/plotting/base.py:287: UserWarning:

    Interactive mode requires 'panel'. Setting 'interactive=False'


    <IPython.core.display.Image object>



.. GENERATED FROM PYTHON SOURCE LINES 46-53

Next, lets see whether cortical thickness is related to age in our sample
data. To this end we can create a linear model with BrainStat. First we
declare the behavioral variables as FixedEffects. The FixedEffect class can be
created in two ways: either we provide the data with pandas, as we do here, or
we provide a numpy array and a name for the fixed effect. Once, that's done we
can create the model by simply adding the terms together. Lets set up a model
with age and patient status as fixed effects.

.. GENERATED FROM PYTHON SOURCE LINES 53-63

.. code-block:: default


    from brainstat.stats.terms import FixedEffect

    demographics.DX_GROUP[demographics.DX_GROUP == 1] = "Patient"
    demographics.DX_GROUP[demographics.DX_GROUP == 2] = "Control"

    term_age = FixedEffect(demographics.AGE_AT_SCAN)
    term_patient = FixedEffect(demographics.DX_GROUP)
    model = term_age + term_patient





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /Users/reinder/GitHub/BrainStat/docs/python/tutorials/plot_tutorial_01_basics.py:56: SettingWithCopyWarning:


    A value is trying to be set on a copy of a slice from a DataFrame

    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy

    /Users/reinder/GitHub/BrainStat/docs/python/tutorials/plot_tutorial_01_basics.py:57: SettingWithCopyWarning:


    A value is trying to be set on a copy of a slice from a DataFrame

    See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy





.. GENERATED FROM PYTHON SOURCE LINES 64-66

As said before, if your data is not in a pandas DataFrame (e.g. numpy), you'll
have to provide the name of the effect as an additional parameter as follows:

.. GENERATED FROM PYTHON SOURCE LINES 66-68

.. code-block:: default

    term_age_2 = FixedEffect(demographics.AGE_AT_SCAN.to_numpy(), "AGE_AT_SCAN")








.. GENERATED FROM PYTHON SOURCE LINES 69-72

Beside simple fixed effects, we may also be interested in interaction
effects. We can add these to the model by multiplying terms. Lets
create a model with an interaction between age and patient status.

.. GENERATED FROM PYTHON SOURCE LINES 72-75

.. code-block:: default


    model_interaction = term_age + term_patient + term_age * term_patient








.. GENERATED FROM PYTHON SOURCE LINES 76-80

Lets have a look at one of these models. As you can see below, the model
is stored in a format closely resembling a pandas DataFrame. Note that an
intercept is automatically added to the model. This behavior can be disabled
in the FixedEffect call, but we recommend leaving it enabled.

.. GENERATED FROM PYTHON SOURCE LINES 80-83

.. code-block:: default


    print(model)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

         intercept  AGE_AT_SCAN  DX_GROUP_Control  DX_GROUP_Patient
    0            1        24.45                 0                 1
    1            1        19.09                 0                 1
    2            1        13.73                 0                 1
    3            1        13.37                 0                 1
    4            1        17.78                 0                 1
    ..         ...          ...               ...               ...
    111          1        10.08                 1                 0
    112          1         9.69                 1                 0
    113          1        11.99                 1                 0
    114          1        10.53                 1                 0
    115          1        10.64                 1                 0

    [116 rows x 4 columns]




.. GENERATED FROM PYTHON SOURCE LINES 84-90

Now, imagine we have some cortical marker (e.g. cortical thickness) for
each subject, and we want to evaluate whether this marker changes with age
whilst correcting for effects of patient status. To do this, we can use
the model we defined before, and a contrast in observations (here: age).
Then we simply initialize an SLM model and fit it to the cortical thickness
data.

.. GENERATED FROM PYTHON SOURCE LINES 90-100

.. code-block:: default


    from brainstat.stats.SLM import SLM

    contrast_age = model.AGE_AT_SCAN
    slm_age = SLM(
        model, contrast_age, surf="civet41k", mask=mask, correction=["fdr", "rft"]
    )
    slm_age.fit(thickness)









.. GENERATED FROM PYTHON SOURCE LINES 101-103

Next, we will plot the t-values and p-values on the surface. We'll do this a
few times throughout the tutorial so lets define a function to do this.

.. GENERATED FROM PYTHON SOURCE LINES 103-162

.. code-block:: default



    def plot_slm_results(slm):
        # Plot t-values.
        plot_hemispheres(
            pial_left,
            pial_right,
            slm.t,
            label_text=["t-values"],
            color_bar=True,
            color_range=(-4, 4),
            embed_nb=True,
            cmap="bwr",
            size=(1400, 200),
            zoom=1.45,
            nan_color=(0.7, 0.7, 0.7, 1),
            cb__labelTextProperty={"fontSize": 12},
        )

        # Plot p-values.
        pval = slm.P["pval"]["P"]
        pval[pval > 0.05] = np.nan
        pval[~mask] = np.nan
        plot_hemispheres(
            pial_left,
            pial_right,
            pval,
            label_text=["p-values (RFT)"],
            color_bar=True,
            color_range=(0, 0.05),
            embed_nb=True,
            cmap="hot_r",
            size=(1400, 200),
            zoom=1.45,
            nan_color=(0.7, 0.7, 0.7, 1),
            cb__labelTextProperty={"fontSize": 12},
        )

        pval = slm.Q
        pval[pval > 0.05] = np.nan
        pval[~mask] = np.nan
        plot_hemispheres(
            pial_left,
            pial_right,
            pval,
            label_text=["p-values (FDR)"],
            color_bar=True,
            color_range=(0, 0.05),
            embed_nb=True,
            cmap="hot_r",
            size=(1400, 200),
            zoom=1.45,
            nan_color=(0.7, 0.7, 0.7, 1),
            cb__labelTextProperty={"fontSize": 12},
        )


    plot_slm_results(slm_age)




.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_002.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img

    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_003.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img

    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_004.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /Users/reinder/opt/miniconda3/envs/python3.8/lib/python3.8/site-packages/brainspace/plotting/base.py:287: UserWarning:

    Interactive mode requires 'panel'. Setting 'interactive=False'





.. GENERATED FROM PYTHON SOURCE LINES 163-171

BrainStat also allows for assessing significant clusters and peaks. The data
on clusters are stored in tables inside BrainStatModel.P.clus and information
on the peaks is stored in BrainStatModel.P.peak. If a two-tailed test is run
(BrainStat defaults to two-tailed), a table is returned for each tail. The
first table uses the contrast as provided, the second table uses the inverse
contrast. If a one-tailed test is performed, then only a single table is
returned. Lets print the inverted contrast cluster table.


.. GENERATED FROM PYTHON SOURCE LINES 171-174

.. code-block:: default


    print(slm_age.P["clus"][1])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

        clusid  nverts     resels             P
    0        1  8738.0  20.960359  7.450214e-08
    1        2  1088.0   1.597035  6.199703e-04
    2        3   492.0   0.640760  3.336996e-02
    3        4   431.0   0.548288  5.016478e-02
    4        5    64.0   0.214293  2.163199e-01
    5        6    24.0   0.153004  2.791494e-01
    6        7    98.0   0.134613  3.007959e-01
    7        8    43.0   0.115649  3.245283e-01
    8        9     9.0   0.112452  3.286729e-01
    9       10    21.0   0.083554  3.680015e-01
    10      11     2.0   0.041479  4.311918e-01
    11      12     2.0   0.039791  4.338679e-01
    12      13    13.0   0.027494  4.536737e-01
    13      14     1.0   0.023942  4.594935e-01
    14      15     1.0   0.022462  4.619306e-01
    15      16     1.0   0.020655  4.649176e-01
    16      17     1.0   0.017212  4.706384e-01
    17      18     1.0   0.016909  4.711429e-01
    18      19     1.0   0.016418  4.719629e-01
    19      20     1.0   0.015658  4.732333e-01
    20      21     3.0   0.014520  4.751382e-01
    21      22     1.0   0.012733  4.781393e-01
    22      23     1.0   0.012123  4.791654e-01
    23      24     3.0   0.007744  4.865687e-01
    24      25     3.0   0.006308  4.890105e-01
    25      26     2.0   0.006169  4.892463e-01
    26      27     2.0   0.005298  4.907313e-01
    27      28     3.0   0.004389  4.922831e-01
    28      29     1.0   0.003401  4.939718e-01
    29      30     1.0   0.002329  4.958073e-01
    30      31     1.0   0.002069  4.962535e-01
    31      32     1.0   0.001795  4.967233e-01




.. GENERATED FROM PYTHON SOURCE LINES 175-179

Here, we see that cluster 1 contains 8738 vertices and is significant at a
p-value of 7.45e-08. Clusters are sorted by p-value; later clusters will
generally be smaller and have higher p-values. Lets now have a look at the
peaks within these clusters.

.. GENERATED FROM PYTHON SOURCE LINES 179-182

.. code-block:: default


    print(slm_age.P["peak"][1])





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

                t  clusid  vertid         P               yeo7
    0    6.315453       1   72883  0.000007             Visual
    1    6.238381       1   72887  0.000010             Visual
    2    5.872848       1   79402  0.000051             Visual
    3    5.872033       1   79524  0.000051             Visual
    4    5.869464       1   79387  0.000052             Visual
    ..        ...     ...     ...       ...                ...
    289  3.179492      29   53761  0.692415  Ventral Attention
    290  3.177273       3   52592  0.696334       Default mode
    291  3.174514      11   80787  0.701205          Undefined
    292  3.172793      32   55988  0.704244             Limbic
    293  3.165341      23   57026  0.717851             Limbic

    [294 rows x 5 columns]




.. GENERATED FROM PYTHON SOURCE LINES 183-189

By default BrainStat uses a two-tailed test. If you want to get a one-tailed
test, simply specify it in the SLM model initialization with
`two_tailed=False`. Note that the one-tailed test will test for positive
t-values. If you want to test for negative t-values, simply invert the
contrast. We may hypothesize based on prior research that cortical thickness
decreases with age, so we could specify this as follows:

.. GENERATED FROM PYTHON SOURCE LINES 189-203

.. code-block:: default


    # Note the minus in front of contrast_age to test for decreasing thickness with age.
    slm_age_onetailed = SLM(
        model,
        -contrast_age,
        surf="civet41k",
        correction=["fdr", "rft"],
        mask=mask,
        two_tailed=False,
    )
    slm_age_onetailed.fit(thickness)

    plot_slm_results(slm_age_onetailed)




.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_005.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img

    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_006.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img

    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_007.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /Users/reinder/opt/miniconda3/envs/python3.8/lib/python3.8/site-packages/brainspace/plotting/base.py:287: UserWarning:

    Interactive mode requires 'panel'. Setting 'interactive=False'





.. GENERATED FROM PYTHON SOURCE LINES 204-206

Similarly, we could perform an analysis to assess cortical thickness
differences across healthy and patient groups whilst correcting for age.

.. GENERATED FROM PYTHON SOURCE LINES 206-220

.. code-block:: default


    contrast_patient = model.DX_GROUP_Patient - model.DX_GROUP_Control
    slm_patient = SLM(
        model,
        contrast_patient,
        surf="civet41k",
        mask=mask,
        correction=["fdr", "rft"],
    )
    slm_patient.fit(thickness)

    plot_slm_results(slm_patient)





.. rst-class:: sphx-glr-horizontal


    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_008.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img

    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_009.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img

    *

      .. image:: /python/generated_tutorials/images/sphx_glr_plot_tutorial_01_basics_010.png
          :alt: plot tutorial 01 basics
          :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /Users/reinder/opt/miniconda3/envs/python3.8/lib/python3.8/site-packages/brainspace/plotting/base.py:287: UserWarning:

    Interactive mode requires 'panel'. Setting 'interactive=False'





.. GENERATED FROM PYTHON SOURCE LINES 221-228

It appears we do not find statistically significant results for a relationship
between cortical thickness and patient status.

Now, imagine that instead of using a fixed effects model, you would prefer a
mixed effects model wherein the scanning site is a random variable. This is
simple to set up. All you need to do is initialize the site term with the
MixedEffect class, all other code remains identical.

.. GENERATED FROM PYTHON SOURCE LINES 228-243

.. code-block:: default


    from brainstat.stats.terms import MixedEffect

    random_site = MixedEffect(demographics.SITE_ID, name_ran="Site")

    model_random = term_age + term_patient + random_site
    slm_random = SLM(
        model_random,
        contrast_age,
        surf="civet41k",
        mask=mask,
        correction=["fdr", "rft"],
    )
    slm_random.fit(thickness)








.. GENERATED FROM PYTHON SOURCE LINES 244-250

Lets have a closer look at the mixed effect. The variable random_site contains
two important properties: "mean", and "variance". "mean" contains any fixed effects,
whereas "variance" contains the random effects. As we did not specify any fixed
effects, the "mean" term is empty. The "variance" term contains the random effect as
well as the identity term, similar to the intercept in FixedEffects. The identity term
is added by default.

.. GENERATED FROM PYTHON SOURCE LINES 250-252

.. code-block:: default


    print(random_site.variance)




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

           Site    I
    0         1  1.0
    1         1  0.0
    2         1  0.0
    3         1  0.0
    4         1  0.0
    ...     ...  ...
    13451     1  0.0
    13452     1  0.0
    13453     1  0.0
    13454     1  0.0
    13455     1  1.0

    [13456 rows x 2 columns]





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  57.138 seconds)


.. _sphx_glr_download_python_generated_tutorials_plot_tutorial_01_basics.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_tutorial_01_basics.py <plot_tutorial_01_basics.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_tutorial_01_basics.ipynb <plot_tutorial_01_basics.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
